var P={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},z=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function T(n){var r={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},e=n.match(/<\/?([^\s]+?)[/\s>]/);if(e&&(r.name=e[1],(P[e[1]]||n.charAt(n.length-2)==="/")&&(r.voidElement=!0),r.name.startsWith("!--"))){var l=n.indexOf("-->");return{type:"comment",comment:l!==-1?n.slice(4,l):""}}for(var i=new RegExp(z),t=null;(t=i.exec(n))!==null;)if(t[0].trim())if(t[1]){var s=t[1].trim(),c=[s,""];s.indexOf("=")>-1&&(c=s.split("=")),r.attrs[c[0]]=c[1],i.lastIndex--}else t[2]&&(r.attrs[t[2]]=t[3].trim().substring(1,t[3].length-1));return r}var X=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,I=/^\s*$/,J=Object.create(null);function W(n,r){switch(r.type){case"text":return n+r.content;case"tag":return n+="<"+r.name+(r.attrs?function(e){var l=[];for(var i in e)l.push(i+'="'+e[i]+'"');return l.length?" "+l.join(" "):""}(r.attrs):"")+(r.voidElement?"/>":">"),r.voidElement?n:n+r.children.reduce(W,"")+"</"+r.name+">";case"comment":return n+"<!--"+r.comment+"-->"}}var O={parse:function(n,r){r||(r={}),r.components||(r.components=J);var e,l=[],i=[],t=-1,s=!1;if(n.indexOf("<")!==0){var c=n.indexOf("<");l.push({type:"text",content:c===-1?n:n.substring(0,c)})}return n.replace(X,function(u,g){if(s){if(u!=="</"+e.name+">")return;s=!1}var a,o=u.charAt(1)!=="/",h=u.startsWith("<!--"),v=g+u.length,x=n.charAt(v);if(h){var p=T(u);return t<0?(l.push(p),l):((a=i[t]).children.push(p),l)}if(o&&(t++,(e=T(u)).type==="tag"&&r.components[e.name]&&(e.type="component",s=!0),e.voidElement||s||!x||x==="<"||e.children.push({type:"text",content:n.slice(v,n.indexOf("<",v))}),t===0&&l.push(e),(a=i[t-1])&&a.children.push(e),i[t]=e),(!o||e.voidElement)&&(t>-1&&(e.voidElement||e.name===u.slice(2,-1))&&(t--,e=t===-1?l:i[t]),!s&&x!=="<"&&x)){a=t===-1?l:i[t].children;var m=n.indexOf("<",v),d=n.slice(v,m===-1?void 0:m);I.test(d)&&(d=" "),(m>-1&&t+a.length>=0||d!==" ")&&a.push({type:"text",content:d})}}),l},stringify:function(n){return n.reduce(function(r,e){return r+W("",e)},"")}},F=function(){function n(l){var i=/function (.{1,})\(/,t=i.exec(l.constructor.toString());return t&&t.length>1?t[1]:""}var r=function(l,i){if(!l)return[];var t=Function.call.bind(Array.prototype.slice),s=function(f){return n(f)==="CSSMediaRule"},c=function(f){return n(f)==="CSSStyleRule"};i=Array.from(document.styleSheets).filter(f=>!f.href||f.href.startsWith(window.location.origin));var u=i.reduce(function(f,b){return f.concat(t(b.cssRules))},[]),g=u.filter(s);u=u.filter(c),u=u.concat(t(g).reduce(function(f,b){return f.concat(t(b.cssRules))},[]));var a=u.filter(e.bind(null,l)),o=[],h=function(f,b,C){(C===void 0||C==null||C=="")&&(C="all"),this.order=f,this.content=b,this.media=C};if(a.length)for(var v=0;v<a.length;v++){var x=a[v],p=v,m=x.cssText.match(/[\w\]]?\s?{\s?(.*?)}/);if(m&&m.length>1)m=m[1];else continue;var d=x.parentRule==null?x.parentStyleSheet==null?"all":x.parentStyleSheet.media.mediaText:x.parentRule.media.mediaText,w=[...m.matchAll(/var\((.*?)\)/g)];for(let f=0;f<w.length;f++){const b=w[f];var y=getComputedStyle(l).getPropertyValue(b[1]);(y==null||y=="")&&(y=1),m=m.replace(b[0],y)}var w=[...m.matchAll(/--[\s\S][\w\-:]*/g)];for(let f=0;f<w.length;f++){const b=w[f];if(!b[0].includes(":")){var y=getComputedStyle(document.documentElement).getPropertyValue(b[0]);(y==null||y=="")&&(y=1),m=m.replace(b[0],y)}}var k=new h(p,m,d);o.push(k)}if(l.getAttribute("style")){var k=new h(a.length,""+l.getAttribute("style")+";");o.push(k)}return o},e=function(l,i){if(!i.selectorText)return!1;var t=Element.prototype,s=Function.call.bind(t.matchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.msMatchesSelector||t.oMatchesSelector);try{return s(l,i.selectorText)}catch{return!1}};return{getCustomCssRulesOnElement:function(l,i){return r(l,i)}}}();let S=!1,R=!1,N=!1;function L(){S=!0,document.body.style.cursor="crosshair",Y()}function B(){S=!1,R=!1,document.body.style.cursor="auto";var n=document.getElementsByClassName("highlight-wrap");n&&n.length>0&&n[0]&&n[0].parentNode&&n[0].parentNode.removeChild(n[0]),N=!1}function Y(){chrome.runtime.sendMessage("focus",n=>{})}chrome.runtime.onMessage.addListener(function(n,r,e){if(n.fullPageEnabled===!0){L(),R=!0;return}n.enable===!0&&L(),n.enable===!1&&B()});window.addEventListener("mouseover",function(n){if(!!n.target&&!!S&&!N){if(R){j(document.body);return}j(n.target)}});let $=!1,M=[];window.addEventListener("click",async function(n){if(!!n.target&&!!S){if(!$){$=!0;for(let c of Array.from(document.styleSheets)){if(!c.href){M.push(c);continue}await Z(c.href);var r=Array.from(document.styleSheets);M.push(r[r.length-1])}_()}document.body.style.cursor="auto",G(),await q(1);try{var e=E.querySelectorAll("*");e.forEach(function(o,h){o.id||(o.id="w2v-"+h)}),E.id||(E.id="w2v-i");const c=E.outerHTML;var l=O.parse(c,{});const u=[],g=[],a=[];var i=A(l,!0,u,g,a);i.ast[0]&&i.ast[0].attrs.style&&i.ast[0].attrs.style.includes("display:none")&&(i.ast[0].attrs.style=i.ast[0].attrs.style.replace("display:none !important","").replace("display:none",""));var t=O.stringify(i.ast),s=O.stringify(A(l,!1,u,g,a).ast);R?(t=`<html><head></head>${t}</html>`,s=`<html><head><style>
            ${a.map(o=>`.${o.name} {
                ${o.style}
            }`).join(`
`)}
            </style></head>${s}</html>`):s=`<style>
            ${a.map(o=>`.${o.name} {
                ${o.style}
            }`).join(`
`)}
            </style>${s}`,e.forEach(function(o,h){o.id&&o.id.startsWith("w2v-")&&o.removeAttribute("id")}),E.id&&E.id.startsWith("w2v-")&&E.removeAttribute("id"),chrome.runtime.sendMessage({type:"html",html:t,htmlCss:s,classes:a},function(o){console.dir(o)})}catch(c){console.error(c)}B()}});function A(n,r=!1,e=[],l=[],i=[]){const t=JSON.parse(JSON.stringify(n));for(let g=0;g<t.length;g++){const a=t[g];if(a.type==="tag"){if(a.name==="script"||a.name==="style"){t.splice(g,1),g--;continue}if(a.name==="div"&&a.attrs.class==="highlight-wrap"){t.splice(g,1),g--;continue}a.attrs||(a.attrs={});const o=document.getElementById(a.attrs.id);if(!o)continue;var s=F.getCustomCssRulesOnElement(o,M);if(r||(a.attrs.class=""),s.length>0){s=s.reverse().filter(h=>window.matchMedia(h.media).matches);var c=s.reduce((h,v)=>{var x=v.content.split(";").filter(p=>p.trim().length>0).map(p=>p.trim());return x.forEach(p=>{var m=p.split(":"),d=m[0].trim();if(h.indexOf(";"+d+":")===-1&&h.indexOf(""+d)!==0){if(p.replaceAll(" ","")==="font:inherit"&&s.find(w=>w.content.includes("font-"))||p.includes("--tw")&&!s.find(w=>w.content.includes(d)&&!w.content.includes(d+":"))||d==="background"&&m[1].includes("none"))return;if(d=="background-clip"&&(d="-webkit-background-clip"),d!="width"&&!p.includes("auto")){var y=window.getComputedStyle(o)[d];if(y){d==="background"&&y.endsWith("text")?h+=d+":"+y.replace("text",";-webkit-background-clip: text")+";":h+=d+":"+y+";";return}}d==="background"&&p.endsWith("text")&&(p=p.replace("text",";-webkit-background-clip: text")),h+=p+";"}}),h},a.attrs.style||"");if(r)a.attrs.style=c.replaceAll('"',"'"),delete a.attrs.class;else{var u=i.find(h=>h.name==="style-"+i.length);u||(u={name:"style-"+i.length,style:c.replaceAll('"',"'")},i.push(u)),a.attrs.class=u.name,delete a.attrs.style}}a.attrs.id&&delete a.attrs.id,a.children&&(a.children=A(a.children,r,e,l,i).ast)}else a.type}return{ast:t}}let E;function j(n){E=n;let r=document.getElementsByClassName("highlight-wrap"),e;r.length!==0?(e=r[0],e.innerHTML=""):(e=document.createElement("div"),e.className="highlight-wrap",e.style.position="absolute",e.style.backgroundColor="#205081",e.style.cursor="default",e.style.pointerEvents="none",document.body.appendChild(e)),e.style.opacity="0.5";let l=E.getBoundingClientRect();e.style.left=l.left+window.scrollX+"px",e.style.top=l.top+window.scrollY+"px",e.style.width=l.width+"px",e.style.height=l.height+"px",e.style.zIndex="9999"}function G(){const n=document.body;let r=document.getElementsByClassName("highlight-wrap"),e;r.length!==0?e=r[0]:(e=document.createElement("div"),e.className="highlight-wrap",e.style.position="absolute",e.style.backgroundColor="#205081",e.style.cursor="default",e.style.pointerEvents="none",document.body.appendChild(e)),e.style.opacity="0.9";let l=n.getBoundingClientRect();e.style.left=l.left+window.scrollX+"px",e.style.top=l.top+window.scrollY+"px",e.style.width=l.width+"px",e.style.height=l.height+"px",e.style.zIndex="9999",e.style.textAlign="center";let i=document.createElement("div");i.className="lds-dual-ring",i.style.marginTop="40vh",e.appendChild(i);let t=document.createElement("div");t.innerHTML="Exporting HTML and CSS",t.style.marginTop="40px",t.style.textAlign="center",t.style.fontSize="1.5rem",t.style.color="white",e.appendChild(t),N=!0}function Z(n){return new Promise((r,e)=>{var l=XMLHttpRequest,i=!1;try{i=l&&"withCredentials"in new l}catch{}if(!!i){var t=new l;t.open("GET",n),t.onload=function(){if(t.onload=t.onerror=null,t.status<200||t.status>=300)console.error("style failed to load: "+n);else{var s=document.createElement("style");s.appendChild(document.createTextNode(t.responseText)),document.head.appendChild(s)}r(null)},t.onerror=function(){t.onload=t.onerror=null,console.error("XHR CORS CSS fail:"+n),r(null)},t.send()}})}function _(){const n=`.lds-dual-ring {
        display: inline-block;
        width: 80px;
        height: 80px;
      }
      .lds-dual-ring:after {
        content: " ";
        display: block;
        width: 64px;
        height: 64px;
        margin: 8px;
        border-radius: 50%;
        border: 6px solid #fff;
        border-color: #fff transparent #fff transparent;
        animation: lds-dual-ring 1.2s linear infinite;
      }
      @keyframes lds-dual-ring {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }`,r=document.createElement("style");r.appendChild(document.createTextNode(n)),document.head.appendChild(r)}function q(n){return new Promise(r=>setTimeout(r,n))}
